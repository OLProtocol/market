(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1205],{72994:function(e,s,t){Promise.resolve().then(t.bind(t,61713))},61713:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return E}});var a=t(57437),l=t(4922),i=t(49365),n=t(86712),r=t(99008),c=t(65349),u=t(43949),o=t(2265),m=t(55981),d=t(90535),x=t(47448),p=t(77807),v=t(98286),h=t(80502),f=t(62234),g=t(86418),b=t(2131),j=t(19409),N=t(42228);function w(e){let{inputList:s,tickerList:t,handleTickerSelectChange:l,handleUtxoSelectChange:i,setInputList:n,loading:r}=e,{t:c}=(0,u.$G)(),[m,d]=(0,o.useState)({}),x=()=>{let e=(null==t?void 0:t.map(e=>e.ticker))||[],a=s.items.length+1;n("items",[...s.items,{id:a,value:{ticker:"",utxo:"",sats:0,unit:"sats"},options:{tickers:e,utxos:[]}}])},p=e=>{if(s.items.length>1){let t=s.items.filter(s=>s.id!==e);t.forEach((e,s)=>{e.id=s+1}),n("items",t)}},v=(e,t)=>{let a=t.target.value;s.items[e-1].value.unit=a,n("items",s.items)},f=async(e,s)=>{d(s=>({...s,[e]:!0})),await l(e,s),d(s=>({...s,[e]:!1}))};return console.log("inputList",s),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-base sm:text-lg font-semibold",children:[c("pages.tools.transaction.input")," UTXO"]}),(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4",children:s.items.map((e,l)=>{var n,c,u,o;return(0,a.jsxs)("div",{className:"border border-divider bg-content1 p-2 sm:p-3 rounded-lg space-y-2 sm:space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm sm:text-base font-medium",children:["Input ",l+1]}),(0,a.jsxs)("div",{className:"flex space-x-1 sm:space-x-2",children:[(0,a.jsx)(g.A,{size:"sm",color:"primary",variant:"flat",onClick:x,className:"min-w-[24px] sm:min-w-[32px] h-6 sm:h-8 px-1 sm:px-2",children:"+"}),(0,a.jsx)(g.A,{size:"sm",color:"danger",variant:"flat",onClick:()=>p(e.id),className:"min-w-[24px] sm:min-w-[32px] h-6 sm:h-8 px-1 sm:px-2",isDisabled:1===s.items.length,children:"-"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2 sm:gap-3",children:[(0,a.jsx)(b.g,{label:"Ticker",placeholder:"Select Ticker",size:"sm",className:"w-full",selectedKeys:(null===(n=e.value)||void 0===n?void 0:n.ticker)?[e.value.ticker]:[],onChange:s=>f(e.id,s.target.value),isLoading:m[e.id]||r,children:null==t?void 0:t.map(e=>(0,a.jsx)(j.R,{value:e.ticker,children:(0,h.t2)(e.ticker)},e.ticker))}),(0,a.jsx)(b.g,{label:"UTXO",placeholder:"Select UTXO",size:"sm",className:"w-full",selectedKeys:(null===(c=e.value)||void 0===c?void 0:c.utxo)?[e.value.utxo]:[],onChange:s=>i(e.id,s.target.value),isLoading:m[e.id]||r,children:null===(o=e.options)||void 0===o?void 0:null===(u=o.utxos)||void 0===u?void 0:u.map(e=>(0,a.jsx)(j.R,{textValue:e.txid+":"+e.vout,children:(0,a.jsxs)("div",{className:"truncate text-xs sm:text-sm",children:[e.assetamount&&e.assetamount+" Asset/",e.value+" sats - "+(0,h.NH)(e.txid+":"+e.vout)]})},e.txid+":"+e.vout))}),(0,a.jsx)(N.Y,{type:"number",label:"Amount",placeholder:"0",size:"sm",readOnly:!0,className:"w-full",value:"sats"===e.value.unit?e.value.sats:e.value.sats/1e8,endContent:(0,a.jsxs)(b.g,{"aria-label":"Select unit",size:"sm",className:"w-24 sm:w-32 min-w-max",selectedKeys:[e.value.unit],onChange:s=>v(e.id,s),children:[(0,a.jsx)(j.R,{value:"sats",children:"sats"},"sats"),(0,a.jsx)(j.R,{value:"btc",children:"btc"},"btc")]})})]})]},l)})})]})}var y=t(40694);function k(e){let{outputList:s,setOutputList:t,address:l}=e,{t:i}=(0,u.$G)(),n=()=>{let e=s.items.length+1;t("items",[...s.items,{id:e,num:1,value:{sats:0,unit:"sats",address:""}}])},r=e=>{if(s.items.length>1){let a=s.items.filter(s=>s.id!==e);a.forEach((e,s)=>{e.id=s+1}),t("items",a)}},c=(e,a)=>{s.items[e-1].value.address=a,t("items",s.items)},o=(e,a)=>{console.log(a),"sats"===s.items[e-1].value.unit?s.items[e-1].value.sats=Number(a):s.items[e-1].value.sats=1e8*Number(a),t("items",s.items)},m=(e,a)=>{console.log(Number(a)),s.items[e-1].num=Number(a),t("items",s.items)},d=(e,a)=>{let l=a.target.value;s.items[e-1].value.unit=l,t("items",s.items)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-base sm:text-lg font-semibold",children:[i("pages.tools.transaction.output")," UTXO"]}),(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4",children:s.items.map((e,t)=>{var i;return(0,a.jsxs)("div",{className:"border border-divider bg-content1 p-2 sm:p-3 rounded-lg space-y-2 sm:space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm sm:text-base font-medium",children:["Output ",t+1]}),(0,a.jsxs)("div",{className:"flex space-x-1 sm:space-x-2",children:[(0,a.jsx)(N.Y,{type:"number",placeholder:"0",size:"sm",className:"w-20",value:null===(i=e.num)||void 0===i?void 0:i.toString(),onChange:s=>m(e.id,s.target.value)}),(0,a.jsx)(g.A,{size:"sm",color:"primary",variant:"flat",onClick:n,className:"min-w-[24px] sm:min-w-[32px] h-6 sm:h-8 px-1 sm:px-2",children:"+"}),(0,a.jsx)(g.A,{size:"sm",color:"danger",variant:"flat",onClick:()=>r(e.id),className:"min-w-[24px] sm:min-w-[32px] h-6 sm:h-8 px-1 sm:px-2",isDisabled:1===s.items.length,children:"-"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2 sm:gap-3",children:[(0,a.jsx)(N.Y,{label:"BTC Address",placeholder:"Enter BTC Address",size:"sm",value:e.value.address,onChange:s=>c(e.id,s.target.value),className:"w-full",endContent:(0,a.jsx)(y.e,{content:"Fill the BTC address of the current account",children:(0,a.jsx)(g.A,{size:"sm",variant:"flat",onClick:()=>c(e.id,l),className:"px-1 sm:px-2 min-w-[40px] sm:min-w-[60px]",children:"Copy"})})}),(0,a.jsx)(N.Y,{type:"number",label:"Amount",placeholder:"0",size:"sm",className:"w-full",value:"sats"===e.value.unit?e.value.sats:e.value.sats/1e8,onChange:s=>o(e.id,s.target.value),endContent:(0,a.jsxs)(b.g,{"aria-label":"Select unit",size:"sm",className:"w-24 sm:w-32 min-w-max",selectedKeys:[e.value.unit],onChange:s=>d(e.id,s),children:[(0,a.jsx)(j.R,{value:"sats",children:"sats"},"sats"),(0,a.jsx)(j.R,{value:"btc",children:"btc"},"btc")]})})]})]},t)})})]})}function C(e){let{balance:s,setBalance:t,address:l}=e,{t:i}=(0,u.$G)(),n=e=>{t("unit",e.target.value)};return(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("h2",{className:"text-base sm:text-lg font-semibold",children:i("pages.tools.transaction.balance")}),(0,a.jsxs)("span",{className:"text-xs sm:text-sm text-gray-400",children:["(",i("pages.tools.transaction.balance_des"),")"]})]}),(0,a.jsxs)("div",{className:"border border-divider bg-content1 p-2 sm:p-3 rounded-lg  space-y-2 sm:space-y-3",children:[(0,a.jsx)(N.Y,{label:"Current Address",value:l,readOnly:!0,size:"sm",className:"w-full"}),(0,a.jsx)(N.Y,{type:"number",label:"Balance",placeholder:"0",size:"sm",value:"sats"===s.unit?s.sats:s.sats/1e8,className:"w-full",endContent:(0,a.jsxs)(b.g,{"aria-label":"Select unit",size:"sm",className:"w-24 sm:w-32 min-w-max",selectedKeys:[s.unit],onChange:e=>n(e),children:[(0,a.jsx)(j.R,{value:"sats",children:"sats"},"sats"),(0,a.jsx)(j.R,{value:"btc",children:"btc"},"btc")]})})]})]})}var _=t(9801);function z(e){let{loading:s,splitHandler:t,fee:l,feeRate:i}=e,{t:n}=(0,u.$G)();return(0,a.jsxs)("div",{className:"flex flex-col items-center w-full space-y-2 sm:space-y-3",children:[(0,a.jsx)(_.j,{className:"w-full",children:(0,a.jsx)(g.A,{color:"primary",onClick:t,isLoading:s,className:"w-full sm:w-auto",size:"sm",children:n("pages.tools.transaction.btn_send")})}),(0,a.jsxs)("div",{className:"text-xs sm:text-sm text-gray-400 text-center",children:[(0,a.jsxs)("p",{children:[n("pages.tools.transaction.network_fee"),": ",l," sats"]}),(0,a.jsxs)("p",{children:[i.value," sat/vb"]})]})]})}function E(){let{t:e}=(0,u.$G)(),{fee:s,loading:t,address:g,inputList:b,outputList:j,balance:N,tickerList:y,handleTickerSelectChange:_,handleUtxoSelectChange:E,setInputList:A,setOutputList:S,setBalance:O,splitHandler:R,feeRate:T}=function(){let{t:e}=(0,u.$G)(),[s,t]=(0,o.useState)(0),{feeRate:a}=(0,p.Ee)(e=>e),[l,i]=(0,o.useState)(!1),{address:n,network:r,publicKey:c}=(0,x.$)(e=>e),[g,b]=(0,o.useState)(0),[j,N]=(0,o.useState)(100),[w,y]=(0,o.useState)(100),[k,{set:C}]=(0,m.Z)({items:[{id:1,value:{ticker:"",utxo:"",sats:0,unit:"sats",description:""},options:{tickers:[],utxos:[]}}]}),[_,{set:z}]=(0,m.Z)({items:[{id:1,num:1,value:{sats:0,unit:"sats",address:""}}]}),[E,{set:A}]=(0,m.Z)({sats:0,unit:"sats"}),[S,{set:O}]=(0,d.Z)([]),R=(0,o.useCallback)((e,s)=>{let t=[...k.items];t[e-1].value={...t[e-1].value,ticker:s,sats:0,unit:"sats",utxo:"",utxos:[]};let a=((null==S?void 0:S.find(e=>e.ticker===s))||[]).utxos;k.items.length>1&&k.items.forEach((s,t)=>{t!==e-1&&(a=[...new Set(a=a.filter(e=>e.txid+":"+e.vout!==s.value.utxo))])}),t[e-1].options.utxos=a,C("items",t)},[k.items,S]),T=(0,o.useCallback)((e,s)=>{let t=s.split(":")[0],a=Number(s.split(":")[1]),l=k.items[e-1].options.utxos.find(e=>e.txid===t&&e.vout===a),i=[...k.items];i[e-1].value={...i[e-1].value,sats:(null==l?void 0:l.value)||0,utxo:s,description:(null==l?void 0:l.assetamount)?"".concat(l.assetamount," Asset/ ").concat(l.value," sats"):"".concat(l.value," sats")},C("items",i),L()},[k.items]),L=(0,o.useCallback)(async()=>{let e=0,s=0;if(k.items.forEach(s=>{e+=s.value.sats}),0===e)return;let l=[];if(_.items.forEach(e=>{for(let s=0;s<e.num;s++)l.push({address:e.value.address,value:e.value.sats})}),l.forEach(e=>{s+=e.value}),0===s)return;let i=k.items.map(e=>({txid:e.value.utxo.split(":")[0],vout:Number(e.value.utxo.split(":")[1]),value:e.value.sats})),u=await (0,h.QV)({utxos:i,outputs:l,feeRate:a.value,network:r,address:n,publicKey:c});t(u),A("sats",e-s-u)},[k.items,_.items,a.value,r,n,c]),Z=(0,o.useCallback)(async()=>{let s=[],t=await (0,v.zO)({address:n,network:r});if(0!==t.code){f.ZP.error({message:e("notification.transaction_title"),description:t.msg});return}let a=t.data.detail;return await Promise.all(a.map(async e=>{if("e"===e.type||"o"===e.type)return;let a=e.type;"f"===e.type&&(a=e.ticker);let l=e.ticker;"n"!==e.type||e.ticker||(l="PureName"),console.log(t="n"===e.type?await v.lI.getOrdxNsUxtos({start:0,limit:j,address:n,sub:l,network:r}):await (0,v.Rw)({start:0,limit:j,address:n,tickerOrAssetsType:a,network:r}));let i=[],c=0;if(0===t.code){let s=("n"===e.type?t.data.names:t.data.detail)||[];c=t.data.total,console.log("details = ",s),s.forEach(e=>{let s={txid:e.utxo.split(":")[0],vout:Number(e.utxo.split(":")[1]),value:e.amount||e.value,assetamount:e.assetamount||e.value};i.push(s)})}console.log("utxosOfTicker = ",i),s.push({ticker:l,type:e.type,total:c,utxos:i})})),s},[n,r,j,e]),$=(0,o.useCallback)(async()=>{let s=await (0,v.wt)({address:n,value:0,network:r});if(0!==s.code){f.ZP.error({message:e("notification.transaction_title"),description:s.msg});return}return{ticker:e("pages.tools.transaction.available_utxo"),utxos:s.data}},[n,r,e]),G=(0,o.useCallback)(async()=>{let s=await (0,v.bA)({address:n,network:r}),t=[];return 0===s.code&&s.data.forEach(s=>{let a=!1;if(s.sats&&s.sats.length>0&&s.sats.forEach(e=>{if(e.satributes&&e.satributes.length>0){a=!0;return}}),a){let a={txid:s.utxo.split(":")[0],vout:Number(s.utxo.split(":")[1]),value:s.value};if(0===t.length)t.push({ticker:e("pages.tools.transaction.rare_sats")+"-"+s.sats[0].satributes[0],utxos:[a]});else{let l=!1;t.forEach(e=>{e.utxos.forEach(e=>{if(e===a.txid+":"+a.vout){l=!0;return}})}),l||(t.some(t=>t.ticker===e("pages.tools.transaction.rare_sats")+"-"+s.sats[0].satributes[0])?t=t.map(t=>t.ticker===e("pages.tools.transaction.rare_sats")+"-"+s.sats[0].satributes[0]?{ticker:t.ticker,utxos:[...t.utxos,a]}:t):t.push({ticker:e("pages.tools.transaction.rare_sats")+"-"+s.sats[0].satributes[0],utxos:[a]}))}}}),t},[n,r,e]),P=(0,o.useCallback)(async()=>{let e=await Z(),s=await $();null==e||e.push(s);let t=await G();O((null==e?void 0:e.concat(t))||[])},[Z,$,G]),U=(0,o.useCallback)(async()=>{if(n){i(!0);try{let s=k.items.reduce((e,s)=>e+s.value.sats,0),t=k.items.map(e=>({txid:e.value.utxo.split(":")[0],vout:Number(e.value.utxo.split(":")[1]),value:e.value.sats})),l=[];_.items.forEach(e=>{for(let s=0;s<e.num;s++)l.push({address:e.value.address,value:e.value.sats})});let u=l.reduce((e,s)=>e+s.value,0),o=await (0,h.QV)({utxos:t,outputs:l,feeRate:a.value,network:r,address:n,publicKey:c});if(s-u-o<0){i(!1),f.ZP.error({message:e("notification.transaction_title"),description:"Not enough sats"});return}let m=await (0,h.cq)({utxos:t,outputs:l,feeRate:a.value,network:r,address:n,suitable:!1,publicKey:c});await (0,h.hw)(m),i(!1),f.ZP.success({message:e("notification.transaction_title"),description:e("notification.transaction_spilt_success")}),b(e=>e+1)}catch(s){console.log("error(transfer sats) = ",s),i(!1),f.ZP.error({message:e("notification.transaction_title"),description:s.message||e("notification.transaction_spilt_fail")})}}},[n,k.items,_.items,a.value,r,c,e]);return(0,o.useEffect)(()=>{L()},[a,k,_]),(0,o.useEffect)(()=>{O([]),C("items",[{id:1,value:{ticker:"",utxo:"",sats:0,unit:"sats"},options:{tickers:[],utxos:[]}}]),A("sats",0),A("unit","sats"),t(0),z("items",[{id:1,num:1,value:{sats:0,unit:"sats",address:""}}]),n&&P()},[n,g,P]),(0,o.useMemo)(()=>({fee:s,loading:l,address:n,inputList:k,outputList:_,balance:E,tickerList:S,handleTickerSelectChange:R,handleUtxoSelectChange:T,setInputList:C,setOutputList:z,setBalance:A,splitHandler:U,refresh:g,feeRate:a}),[s,l,n,k,_,E,S,R,T,U,g,a])}();return(0,a.jsx)("div",{className:"flex flex-col w-full max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-2 sm:py-4 lg:py-6",children:(0,a.jsxs)(l.w,{className:"w-full",children:[(0,a.jsx)(i.u,{className:"flex flex-col items-start p-3 sm:p-4",children:(0,a.jsx)("h1",{className:"text-lg sm:text-xl font-bold uppercase",children:e("pages.tools.transaction.title")})}),(0,a.jsx)(n.j,{}),(0,a.jsx)(r.G,{className:"p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsx)(w,{loading:t,inputList:b,tickerList:y,handleTickerSelectChange:_,handleUtxoSelectChange:E,setInputList:A}),(0,a.jsx)(n.j,{}),(0,a.jsx)(k,{outputList:j,setOutputList:S,address:g}),(0,a.jsx)(n.j,{}),(0,a.jsx)(C,{balance:N,setBalance:O,address:g})]})}),(0,a.jsx)(n.j,{}),(0,a.jsx)(c.i,{className:"flex flex-col items-center p-3 sm:p-4",children:(0,a.jsx)(z,{loading:t,splitHandler:R,fee:s,feeRate:T})})]})})}},9801:function(e,s,t){"use strict";t.d(s,{j:function(){return r}});var a=t(57437),l=t(86418),i=t(47448);t(2265);var n=t(43949);let r=e=>{var s;let{children:t,className:r,text:c,keepStyle:u}=e;null==t||null===(s=t.props)||void 0===s||s.onClick;let{t:o}=(0,n.$G)(),{connected:m,setModalVisible:d}=(0,i.$)(e=>e);return m||u?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l.A,{variant:"ghost",size:"md",onClick:()=>d(!0),radius:"sm",className:r,color:"primary",children:c||o("buttons.connect")})})}}},function(e){e.O(0,[3121,1866,1645,8218,8991,9874,2234,1349,9222,1800,4214,3541,694,1865,2753,7233,2971,2117,1744],function(){return e(e.s=72994)}),_N_E=e.O()}]);