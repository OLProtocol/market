(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2318],{35783:function(e,s,t){Promise.resolve().then(t.bind(t,94764))},94764:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Z}});var a=t(57437),i=t(51446),l=t(62121),n=t(17993),c=t(8127),r=t(12308),o=t(29629),d=t(9139),m=t(964),u=t(93908),x=t(71272),h=t(7337),p=t(24112),g=t(55448),j=t(68937),f=t(90720),v=t(1271),_=t(65647),b=t(2265),N=t(69077),y=t(14498),w=t(57603),C=t(24842),S=t(65703),P=t(90089),k=t(16463),B=t(91617),R=t(48494);function Z(){let{t:e}=(0,P.$G)(),s=(0,k.useRouter)(),[t,Z]=(0,b.useState)(!1),{assets_name:T,assets_type:O,list:z,reset:D,unit:E,amountUnit:U,changeAmountUnit:A,changeUnit:G,changePrice:K}=(0,_.JU)(e=>e),[L,X]=(0,b.useState)(!1),[I,J]=(0,b.useState)();console.log("app.account.sell.page: list: ",z);let{network:M,address:V,btcWallet:Y}=(0,C.$)(e=>e),{data:$,isLoading:q}=(0,B.ZP)("getAssetsSummary-".concat(T,"-").concat(O,"-").concat(M),()=>{console.log("app.account.sell.page: ticker: ",T);try{return(0,S.zU)({assets_name:T,assets_type:O})}catch(e){console.log("app.account.sell.page: getAssetsSummary err: ",e)}},{revalidateOnFocus:!1,revalidateOnReconnect:!1}),F=(0,b.useMemo)(()=>{var e;return(null==$?void 0:null===(e=$.data)||void 0===e?void 0:e.summary)||{}},[$]);(0,b.useEffect)(()=>{if(F.lowest_price)for(let e of z)"btc"===E?K(e.utxo,(0,N.Ay)(parseInt(F.lowest_price)).toString()):K(e.utxo,parseInt(F.lowest_price).toString())},[F]),(0,R.Z)(()=>{if(L){let e=I?Number(I):0;for(let s=0;s<z.length;s++)K(z[s].utxo,e.toString())}},300,[L,I]);let H=async()=>{for(let s=0;s<z.length;s++){let{price:t,assets_list:a}=z[s];if(330>Number("btc"===U?(0,N.g)(t):t)){v.ZP.error({message:e("notification.list_failed_title"),description:e("notification.list_failed_min_amount")});return}}if(!(0,y.Sd)(V,M)){v.ZP.error({message:e("notification.list_failed_title"),description:e("notification.list_failed_p2tr_required")});return}Z(!0);try{let t=await (0,N.c8)({inscriptionUtxos:z,address:V,network:M,unit:U});console.log("Batch Order PSBT",t);let a=await (null==Y?void 0:Y.signPsbt(t));if(console.log("Batch Order raw",a),a){let t=(0,N.T1)(a,M),i=z.map((e,s)=>{let a;let{assets_list:i}=e;return{assets_name:(a="ticker"===O?i.find(e=>e.assets_name===T):i.find(e=>e.assets_type===O)).assets_name,assets_type:a.assets_type,raw:t[s]}}),l=await (0,S.wC)({address:V,orders:i});200===l.code?(v.ZP.success({message:e("notification.list_success_title"),description:e("notification.list_success_description")}),D(),s.back()):v.ZP.error({message:e("notification.list_failed_title"),description:l.msg})}Z(!1)}catch(s){Z(!1),console.error("List failed",s),v.ZP.error({message:e("notification.list_failed_title"),description:s.message})}},Q=e=>{},W=e=>{e!==E&&e&&G(e)},ee=e=>{console.log("unit change",e),e!==U&&e&&A(e)},es=(0,b.useMemo)(()=>z.reduce((e,s)=>{let t=new w.t(e),a=new w.t(Number(s.price));return t.plus(a).toNumber()},0)||0,[z]);return(0,a.jsx)("div",{className:"py-2",children:(0,a.jsxs)("div",{className:"md:flex justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 mb-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 mb-2 md:flex-row md:items-center  ",children:[q?(0,a.jsx)(i.c,{}):(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsx)("div",{className:"flex items-center gap-4"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{children:[e("common.lowest_price"),":"]}),(0,a.jsxs)("span",{children:[F.lowest_price," Sats"]})]})]}),(0,a.jsxs)("div",{className:"w-full flex items-center gap-1 sm:w-80",children:[(0,a.jsx)(l.Y,{type:"number",placeholder:"Custome Global Unit Price",value:I,onValueChange:e=>{X(!0),J(e)}}),(0,a.jsxs)(n.g,{size:"sm",color:"primary",isDisabled:q,selectedKeys:[E],onChange:e=>W(e.target.value),className:"w-28",children:[(0,a.jsx)(c.R,{value:"btc",children:"BTC"},"btc"),(0,a.jsx)(c.R,{value:"sats",children:"sats"},"sats")]})]})]}),(0,a.jsxs)(r.b,{"aria-label":"Example static collection table",children:[(0,a.jsxs)(o.J,{children:[(0,a.jsx)(d.j,{className:"text-sm md:text-base",children:e("common.item")}),(0,a.jsx)(d.j,{className:"text-sm md:text-base ",children:(0,a.jsxs)("div",{className:"flex  items-center gap-2",children:[e("common.sell_unit_price"),(0,a.jsxs)(n.g,{size:"sm",color:"primary",isDisabled:q,selectedKeys:[E],onChange:e=>W(e.target.value),className:"w-28",children:[(0,a.jsx)(c.R,{value:"btc",children:"BTC"},"btc"),(0,a.jsx)(c.R,{value:"sats",children:"sats"},"sats")]})]})}),(0,a.jsx)(d.j,{className:"text-sm md:text-base",children:(0,a.jsxs)("div",{className:"flex  items-center gap-2",children:[e("common.amount"),(0,a.jsxs)(n.g,{size:"sm",color:"primary",isDisabled:q,selectedKeys:[U],onChange:e=>ee(e.target.value),className:"w-28",children:[(0,a.jsx)(c.R,{value:"btc",children:"BTC"},"btc"),(0,a.jsx)(c.R,{value:"sats",children:"sats"},"sats")]})]})})]}),(0,a.jsx)(m.y,{children:z.map((s,t)=>{var i;return(0,a.jsxs)(u.g,{children:[(0,a.jsxs)(x.X,{children:[(0,a.jsx)("div",{className:"mb-2 flex flex-wrap items-center gap-4",children:null===(i=s.assets_list)||void 0===i?void 0:i.map(s=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["ns"===s.assets_type?"Name":"Ticker","："]}),(0,a.jsx)("span",{children:s.assets_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-gray-400",children:[e("common.asset_num"),"："]}),(0,a.jsx)("span",{children:s.amount})]})]},s.assets_name))}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400 mr-4",children:"Sats:"}),s.value]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Utxo："}),(0,a.jsx)(h.Z,{codeString:null==s?void 0:s.utxo,className:"bg-transparent text-gray-500",symbol:"",size:"lg",variant:"flat",children:(0,a.jsx)("span",{className:"font-thin",children:(0,N.NH)(null==s?void 0:s.utxo,6)})})]})]}),(0,a.jsx)(x.X,{children:(0,a.jsx)(l.Y,{type:"number",placeholder:"0.00",isDisabled:q,value:z[t].unit_price,onValueChange:e=>{X(!1),J(void 0),K(s.utxo,e)},onBlur:()=>Q(s.utxo)})}),(0,a.jsx)(x.X,{className:"text-center",children:s.price})]},s.utxo)})})]})]}),(0,a.jsxs)(p.w,{className:"sm:w-60 ",children:[(0,a.jsxs)(g.G,{children:[(0,a.jsxs)("div",{children:[e("common.total"),": ",z.length]}),(0,a.jsxs)("div",{children:[e("common.your_profits"),": ",es," ","btc"===U?"BTC":"Sats"]})]}),(0,a.jsx)(j.i,{children:(0,a.jsx)(f.A,{isDisabled:es<=0,color:"primary",isLoading:t,className:"w-full",onClick:H,children:e("buttons.list_sale")})})]})]})})}}},function(e){e.O(0,[3121,1866,1645,8218,5041,1277,1271,4276,6425,8807,2292,2822,5891,233,8563,168,787,8404,1447,2971,7023,1744],function(){return e(e.s=35783)}),_N_E=e.O()}]);