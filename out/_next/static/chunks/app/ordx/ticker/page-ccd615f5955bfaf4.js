(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{3833:function(e,s,l){Promise.resolve().then(l.bind(l,39893))},39893:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return O}});var i=l(57437),n=l(42853),t=l(62478),r=l(51763),a=l(89571),c=l(39248),d=l(46802),o=l(13479),u=l(2265),x=l(31197),m=l(28034),h=l(54994),v=l(21507),j=l(20853),f=l(12765),g=l(15442),b=l(4990);let p=e=>{var s;let{item:l,onBuy:n}=e;return(0,i.jsxs)(h.w,{isPressable:!0,radius:"lg",className:"border-none w-60 max-h-[18rem]",children:[(0,i.jsx)(v.G,{children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[(0,i.jsx)("div",{className:"flex-1",children:null==l?void 0:null===(s=l.assets)||void 0===s?void 0:s.map(e=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:["# ",e.inscriptionnum]}),(0,i.jsx)("div",{children:e.ticker}),(0,i.jsx)("div",{children:e.amount})]},e.inscriptionnum))}),(0,i.jsx)(j.z,{size:"lg",className:"w-full max-w-none text-small",children:(0,i.jsxs)("div",{children:[null==l?void 0:l.price," BTC"]})})]})}),(0,i.jsx)(f.i,{className:"",children:(0,i.jsx)(b.j,{className:"flex-1",children:(0,i.jsx)(g.A,{className:"text-tiny flex-1 ",variant:"flat",color:"default",radius:"lg",onClick:n,children:"购买"})})})]})};var y=l(48615),N=l(43433),k=l(55745),w=l(61718),C=l(69571),S=l(77883),_=l(45696),P=l(2913),M=l(33261),T=l(48749),E=l(56690),z=l(68638);let F=e=>{let{visiable:s,item:l,onClose:r,onSuccess:a}=e,c=(0,M.env)("NEXT_PUBLIC_SERVICE_FEE"),d=(0,M.env)("NEXT_PUBLIC_IS_FREE"),o=0;c&&"0"==d&&(o=Number(c));let{feeRate:x}=(0,z.Ee)(e=>e),{balance:m,address:h,network:v}=(0,z.sD)(e=>e),[f,b]=(0,u.useState)(!1),{isOpen:p,onOpen:F,onOpenChange:U,onClose:Z}=(0,y.q)(),{data:D,isLoading:O}=(0,n.ZP)("getUtxoByValue-".concat(h,"-").concat(v),()=>(0,t.wt)({address:h,network:v,value:500})),R=(0,u.useMemo)(()=>(null==D?void 0:D.data)||[],[D]),B=()=>{null==r||r(),Z()},A=async()=>{console.log("confirmHandler");try{var e;h&&v&&(null===(e=I.smallTwoUtxos)||void 0===e?void 0:e.length)||T.ZP.warning({message:"buy error",description:"数据错误"}),b(!0);let s=await (0,E.Us)({orderId:l.order_id,utxos:I.utxos,dummyUtxos:I.smallTwoUtxos,fee:I.fee,address:h,network:v,serviceFee:o,feeRate:x.value}),i=await (0,t.Hj)({order_id:null==l?void 0:l.order_id,address:h,raw:s});200===i.code?(T.ZP.success({message:"buy successfully",description:"The order has been submitted successfully, please wait for the buyer to buy it."}),null==a||a(),B()):T.ZP.error({message:"buy failed",description:i.msg})}catch(e){T.ZP.error({message:"buy failed",description:e.message})}finally{b(!1)}},I=(0,u.useMemo)(()=>{let e=890*x.value;if(!R.length||!(null==l?void 0:l.price))return{fee:0,utxos:[]};let{utxos:s,smallTwoUtxos:i}=(0,E.zU)(R,e+330+(null==l?void 0:l.price)+o),n=(180*(s.length+4)+136+10)*x.value;return{fee:n,utxos:s,smallTwoUtxos:i}},[x,R,null==l?void 0:l.price]),X=(0,u.useMemo)(()=>l?l.price:0,[l]);return(0,u.useEffect)(()=>{s?F():Z()},[s]),(0,i.jsx)(N.R,{backdrop:"blur",isDismissable:!1,isOpen:p,onOpenChange:U,onClose:B,children:(0,i.jsx)(k.A,{children:e=>{var s;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.k,{className:"",children:"立即购买"}),(0,i.jsxs)(C.I,{children:[(0,i.jsxs)("div",{className:"flex  justify-between",children:[(0,i.jsx)("div",{className:"flex-1",children:null==l?void 0:null===(s=l.assets)||void 0===s?void 0:s.map(e=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[e.amount," ",e.ticker]}),(0,i.jsxs)("div",{children:["# ",e.inscriptionnum]})]},e.inscriptionnum))}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:["价格: ",null==l?void 0:l.price," BTC"]}),(0,i.jsxs)("div",{className:"flex items-center",children:["来自:",(0,i.jsx)(S.Z,{codeString:null==l?void 0:l.address,className:"bg-transparent",symbol:"",size:"sm",variant:"flat",children:(0,E.NH)(null==l?void 0:l.address,4)})]})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{children:"Fee Rate"}),(0,i.jsxs)("div",{children:[x.value," ",(0,i.jsx)("span",{children:"sats"})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{children:"平台服务费"}),(0,i.jsxs)("div",{children:[o," ",(0,i.jsx)("span",{children:"sats"})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{children:"网络费用"}),O||!I.fee?(0,i.jsx)(_.c,{size:"sm"}):(0,i.jsxs)("div",{children:[I.fee," ",(0,i.jsx)("span",{children:"sats"})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg",children:[(0,i.jsx)("span",{children:"总计"}),(0,i.jsxs)("div",{children:[X," ",(0,i.jsx)("span",{children:"BTC"})]})]}),(0,i.jsx)(j.z,{radius:"sm",size:"lg",className:"w-full max-w-none text-small",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{children:"可用余额"}),(0,i.jsxs)("span",{children:[m.confirmed," BTC"]})]})})]}),(0,i.jsxs)(P.R,{children:[(0,i.jsx)(g.A,{color:"danger",variant:"light",onPress:B,children:"关闭"}),(0,i.jsx)(g.A,{isLoading:f,isDisabled:!I.fee,color:"primary",onPress:A,children:"确认"})]})]})}})})};var U=l(24033);let Z=e=>{let{ticker:s,address:l}=e;(0,U.useRouter)();let[r,a]=(0,u.useState)(!1),[c,d]=(0,u.useState)(),[h,v]=(0,u.useState)(1),[j,f]=(0,u.useState)(10),g=(0,u.useMemo)(()=>l?"/ordx/getOrders-".concat(s,"-").concat(l,"-").concat(h,"-").concat(j):"/ordx/getOrders-".concat(s,"-").concat(h,"-").concat(j),[s,l,h,j]),{data:b,isLoading:y,mutate:N}=(0,n.ZP)(g,()=>(0,t.AU)({offset:(h-1)*j,size:j,ticker:s,address:l})),k=e=>{d(e),a(!0)},w=()=>{N(g)},C=(0,u.useMemo)(()=>{var e,s;return(null==b?void 0:null===(e=b.data)||void 0===e?void 0:e.total)?Math.ceil((null==b?void 0:null===(s=b.data)||void 0===s?void 0:s.total)/j):0},[b,j]),S=(0,u.useMemo)(()=>{var e;return(null==b?void 0:null===(e=b.data)||void 0===e?void 0:e.order_list)||[]},[b]);return(0,i.jsxs)("div",{className:"",children:[(0,i.jsxs)(m.V,{loading:y,children:[!S.length&&(0,i.jsx)(o.Z,{className:"mt-10"}),(0,i.jsx)("div",{className:"min-h-[30rem] grid  grid-1 sm:grid-2 md:grid-4 lg:grid-6 gap-4 mb-4",children:S.map(e=>(0,i.jsx)(p,{item:e,onBuy:()=>k(e)},e.utxo))})]}),C>1&&(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)(x.t,{total:C,offset:h,size:j,onChange:(e,s)=>{v(e)}})}),(0,i.jsx)(F,{item:c,onSuccess:()=>w(),onClose:()=>a(!1),visiable:r})]})};var D=l(41298);function O(){let e=(0,U.useSearchParams)(),{address:s}=(0,z.sD)(e=>e),l=e.get("ticker"),{data:o}=(0,n.ZP)("getTickerSummary",()=>(0,t.RK)({ticker:l})),x=(0,u.useMemo)(()=>{var e;return(null==o?void 0:null===(e=o.data)||void 0===e?void 0:e.summary)||{}},[o]);return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"h-40 flex flex-col",children:(0,i.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,i.jsx)(r.J,{src:null==x?void 0:x.logo,alt:"logo",className:"mr-2 w-20 h-20"}),(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)("div",{children:null==x?void 0:x.ticker})})]})}),(0,i.jsx)(a.j,{}),(0,i.jsx)("div",{className:"pt-4",children:(0,i.jsxs)(c.n,{"aria-label":"Options",children:[(0,i.jsx)(d.r,{title:"市场",children:(0,i.jsx)(Z,{ticker:l})},"market"),(0,i.jsx)(d.r,{title:"交易历史",children:(0,i.jsx)(D.K,{ticker:l})},"history"),(0,i.jsx)(d.r,{title:"我的挂单",children:(0,i.jsx)(b.j,{className:"mx-auto mt-20 block",children:(0,i.jsx)(Z,{ticker:l,address:s})})},"my")]})})]})}},28034:function(e,s,l){"use strict";l.d(s,{V:function(){return t}});var i=l(57437),n=l(45696);l(2265);let t=e=>{let{loading:s=!0,className:l,children:t}=e;return(0,i.jsxs)("div",{className:"relative ".concat(l),children:[t,s&&(0,i.jsx)("div",{className:"absolute top-1/2 left-1/2 z-10 -translate-x-1/2 -translate-y-1/2",children:(0,i.jsx)(n.c,{})})]})}},31197:function(e,s,l){"use strict";l.d(s,{t:function(){return t}});var i=l(57437);l(2265);var n=l(82335);let t=e=>{let{total:s,page:l,size:t,onChange:r}=e;return(0,i.jsx)(n.g,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",total:s,initialPage:1,page:l,onChange:r})}},4990:function(e,s,l){"use strict";l.d(s,{j:function(){return r}});var i=l(57437),n=l(15442),t=l(68638);l(2265);let r=e=>{let{children:s,className:l}=e,{connect:r,connected:a}=(0,t.sD)(e=>e);return a?(0,i.jsx)(i.Fragment,{children:s}):(0,i.jsx)(n.A,{onClick:r,size:"sm",radius:"full",className:l,color:"primary",children:"Connect Wallet"})}},41298:function(e,s,l){"use strict";l.d(s,{K:function(){return k}});var i=l(57437),n=l(42853),t=l(19970),r=l(64903),a=l(53115),c=l(2014),d=l(45696),o=l(51240),u=l(52037),x=l(1525),m=l(77883),h=l(62478),v=l(2265),j=l(56690),f=l(39830),g=l(68638),b=l(31197),p=l(68565),y=l(19174);let N=e=>{let{value:s,onChange:l,disabled:n=!1}=e,[t,r]=(0,v.useState)([(null==s?void 0:s.toString())||"0"]);return(0,i.jsx)(p.g,{isDisabled:n,className:"w-40",selectionMode:"single",selectedKeys:t,defaultSelectedKeys:["0"],onSelectionChange:e=>{r(e);let s=Number(Array.from(e.values())[0]);null==l||l(s)},children:[{label:"不排序",value:0},{label:"价格升序",value:1},{label:"价格降序",value:2},{label:"时间升序",value:3},{label:"时间降序",value:4}].map(e=>(0,i.jsx)(y.R,{value:e.value,children:e.label},e.value))})},k=e=>{let{ticker:s,address:l}=e,{network:p}=(0,g.sD)(e=>e),[y,k]=(0,v.useState)(1),[w,C]=(0,v.useState)(10),[S,_]=(0,v.useState)(0),{data:P,isLoading:M}=(0,n.ZP)("/ordx/history-".concat(s,"-").concat(l,"-").concat(y,"-").concat(w,"-").concat(S),()=>(0,h.s1)({offset:(y-1)*w,size:w,ticker:s,address:l,sort:S}),{revalidateOnMount:!0}),T=(0,v.useMemo)(()=>{var e,s;return(null==P?void 0:null===(e=P.data)||void 0===e?void 0:e.total)?Math.ceil((null==P?void 0:null===(s=P.data)||void 0===s?void 0:s.total)/w):0},[P,w]),E=(0,v.useMemo)(()=>({1:"成交",2:"下架",3:"无效",10:"卖出",11:"买入"}),[]),z=(0,v.useMemo)(()=>{let e=[{key:"utxo",label:"Utxo",align:"center"},{key:"price",label:"Price",align:"center"},{key:"value",label:"Num",align:"center"},{key:"address",label:"From",align:"center"},{key:"txaddress",label:"To",align:"center",hideHeader:!0},{key:"txtime",label:"Time",align:"center"},{key:"txid",label:"Tx",allowsSorting:!1,align:"center"}],s=e.findIndex(e=>"txaddress"===e.key);return l&&(e.splice(s,1),e.unshift({key:"result",label:"Type",align:"center"})),e},[l]),F=(0,v.useMemo)(()=>{var e;return(null==P?void 0:null===(e=P.data)||void 0===e?void 0:e.order_list)||[]},[P]);return(0,i.jsx)("div",{className:"",children:(0,i.jsxs)(t.b,{isHeaderSticky:!0,isStriped:!0,topContent:(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(N,{disabled:!F.length,onChange:e=>{void 0!==e&&_(e)}})}),bottomContent:y>1?(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)(b.t,{total:T,offset:y,size:w,onChange:(e,s)=>{k(e)}})}):null,children:[(0,i.jsx)(r.J,{columns:z,children:z.map(e=>(0,i.jsx)(a.j,{align:e.align,children:e.label},e.key))}),(0,i.jsx)(c.y,{isLoading:M,items:F,emptyContent:"No Data.",loadingContent:(0,i.jsx)(d.c,{}),children:e=>(0,i.jsx)(o.g,{children:s=>{if("utxo"===s||"txaddress"===s||"address"===s){let l=(0,u.sF)(e,s);return(0,i.jsx)(x.X,{children:l?(0,i.jsx)(m.Z,{codeString:l,className:"bg-transparent",symbol:"",size:"lg",variant:"flat",children:(0,j.NH)(l,6)}):"-"})}return"txid"===s?(0,i.jsx)(x.X,{children:(0,i.jsx)("a",{href:(0,j.a)((0,u.sF)(e,s),p),target:"_blank",children:(0,i.jsx)(f.JO,{icon:"ph:share-fill"})})}):"txtime"===s?(0,i.jsx)(x.X,{children:(0,i.jsx)("span",{children:new Date(Number((0,u.sF)(e,s))).toLocaleString()})}):"result"===s?(0,i.jsx)(x.X,{children:E[(0,u.sF)(e,s)]}):(0,i.jsx)(x.X,{children:"".concat((0,u.sF)(e,s)).concat("price"===s?" "+e.currency:"")})}},e.order_id)})]})})}}},function(e){e.O(0,[121,645,578,700,226,595,261,515,489,749,988,631,351,971,472,744],function(){return e(e.s=3833)}),_N_E=e.O()}]);