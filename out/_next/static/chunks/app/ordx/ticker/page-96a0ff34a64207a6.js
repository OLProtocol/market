(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{3833:function(e,s,l){Promise.resolve().then(l.bind(l,39893))},39893:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return R}});var t=l(57437),a=l(42853),i=l(19505),n=l(42891),r=l(21507),c=l(62478),d=l(14511),o=l(89571),u=l(48745),x=l(46802),m=l(13479),h=l(48749),v=l(68638),j=l(2265),f=l(31197),g=l(28034),b=l(84956),p=l(12765),y=l(89324);let N=e=>{var s;let{item:l,onBuy:a}=e,[c,d]=(0,j.useState)(!1),o=async()=>{d(!0);try{await a(l)}catch(e){}finally{d(!1)}};return(0,t.jsxs)(n.w,{isPressable:!0,radius:"lg",className:"border-none w-full h-[14rem] md:h-[20rem]",children:[(0,t.jsx)(r.G,{children:(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"flex-1 text-sm md:text-base",children:null==l?void 0:null===(s=l.assets)||void 0===s?void 0:s.map(e=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{children:["Ticker: ",e.ticker]}),(0,t.jsxs)("div",{children:["Amount: ",e.amount]})]},e.inscriptionnum))}),(0,t.jsx)(b.z,{size:"lg",className:"w-full max-w-none text-small",children:(0,t.jsxs)("div",{children:[null==l?void 0:l.price," BTC"]})})]})}),(0,t.jsx)(p.i,{className:"",children:(0,t.jsx)(y.j,{className:"flex-1",children:(0,t.jsx)(i.A,{className:"text-tiny flex-1 ",variant:"flat",isLoading:c,color:"default",radius:"lg",onClick:o,children:"购买"})})})]})};var w=l(48615),k=l(95844),C=l(72021),_=l(61718),S=l(69571),P=l(95705),M=l(45696),T=l(2913),Z=l(33261),E=l(56690);let z=e=>{var s;let{visiable:l,item:n,orderRaw:r,onClose:d,onSuccess:o}=e,u=(0,Z.env)("NEXT_PUBLIC_SERVICE_FEE"),x=(0,Z.env)("NEXT_PUBLIC_IS_FREE"),m=0;u&&"0"==x&&(m=Number(u));let{feeRate:f}=(0,v.Ee)(e=>e),{balance:g,address:p,network:y}=(0,v.sD)(e=>e),[N,z]=(0,j.useState)(!1),{isOpen:A,onOpen:D,onOpenChange:F,onClose:R}=(0,w.q)(),{data:O,isLoading:U}=(0,a.ZP)("getUtxoByValue-".concat(p,"-").concat(y),()=>(0,c.wt)({address:p,network:y,value:500})),B=(0,j.useMemo)(()=>(null==O?void 0:O.data)||[],[O]),I=(0,j.useMemo)(()=>B.reduce((e,s)=>e+s.value,0),[B]),L=async()=>{z(!0);try{let e=await (0,c.n3)({address:p,order_id:n.order_id});if(200!==e.code){h.ZP.error({message:"Cancel order failed",description:e.msg});return}H()}catch(e){h.ZP.error({message:"Cancel order failed",description:e.message})}finally{z(!1)}},H=()=>{null==d||d(),R()},X=async()=>{console.log("confirmHandler");try{var e;if(!(p&&y&&(null===(e=K.smallTwoUtxos)||void 0===e?void 0:e.length))){h.ZP.warning({message:"buy error",description:"数据错误"});return}if(!r){h.ZP.warning({message:"buy error",description:"Order Raw is empty"});return}z(!0);let s=await (0,E.Us)({orderId:n.order_id,orderRaw:r,utxos:K.utxos,dummyUtxos:K.smallTwoUtxos,fee:K.fee,address:p,network:y,serviceFee:m,feeRate:f.value}),l=await (0,c.Hj)({order_id:null==n?void 0:n.order_id,address:p,raw:s});200===l.code?(h.ZP.success({message:"buy successfully",description:"The order has been submitted successfully, please wait for the buyer to buy it."}),null==o||o(),H()):h.ZP.error({message:"buy failed",description:l.msg})}catch(e){h.ZP.error({message:"buy failed",description:e.message})}finally{z(!1)}},K=(0,j.useMemo)(()=>{let e=890*f.value;if(!B.length||!(null==n?void 0:n.price))return{fee:0,utxos:[]};let{utxos:s,smallTwoUtxos:l}=(0,E.zU)(B,e+330+(null==n?void 0:n.price)+m),t=(180*(s.length+4)+136+10)*f.value;return{fee:t,utxos:s,smallTwoUtxos:l}},[f,B,null==n?void 0:n.price]),V=(0,j.useMemo)(()=>n?(0,E.g)(n.price)+m+K.fee:0,[n,m,K.fee]),J=(0,j.useMemo)(()=>I<V,[I,V]),G=(0,j.useMemo)(()=>J,[J]);return(0,j.useEffect)(()=>{l?D():R()},[l]),(0,t.jsx)(k.R,{hideCloseButton:!0,backdrop:"blur",isDismissable:!1,isOpen:A,onOpenChange:F,onClose:H,children:(0,t.jsxs)(C.A,{children:[(0,t.jsx)(_.k,{className:"",children:"立即购买"}),(0,t.jsxs)(S.I,{children:[(0,t.jsxs)("div",{className:"flex  justify-between",children:[(0,t.jsx)("div",{className:"flex-1",children:null==n?void 0:null===(s=n.assets)||void 0===s?void 0:s.map(e=>(0,t.jsx)("div",{children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-bold",children:["Ticker: ",e.ticker]}),(0,t.jsxs)("div",{className:"text-sm",children:["Amount: ",e.amount]})]})},e.inscriptionnum))}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{children:["价格: ",null==n?void 0:n.price," BTC"]}),(0,t.jsxs)("div",{className:"flex items-center",children:["来自:",(0,t.jsx)(P.Z,{codeString:null==n?void 0:n.address,className:"bg-transparent",symbol:"",size:"sm",variant:"flat",children:(0,E.NH)(null==n?void 0:n.address,4)})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Fee Rate"}),(0,t.jsxs)("div",{children:[f.value," ",(0,t.jsx)("span",{children:"sats"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"平台服务费"}),(0,t.jsxs)("div",{children:[m," ",(0,t.jsx)("span",{children:"sats"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"网络费用"}),U||!K.fee?(0,t.jsx)(M.c,{size:"sm"}):(0,t.jsxs)("div",{children:[K.fee," ",(0,t.jsx)("span",{children:"sats"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg",children:[(0,t.jsx)("span",{children:"总计"}),(0,t.jsxs)("div",{children:[(0,E.Ay)(V)," ",(0,t.jsx)("span",{children:"BTC"})]})]}),(0,t.jsx)(b.z,{radius:"sm",size:"lg",className:"w-full max-w-none text-small",children:(0,t.jsxs)("div",{className:"flex items-center justify-between ".concat(J?"text-red-600":""),children:[(0,t.jsx)("span",{children:"可用余额"}),U||!K.fee?(0,t.jsx)(M.c,{size:"sm"}):(0,t.jsxs)("span",{children:[(0,E.Ay)(I)," BTC"]})]})})]}),(0,t.jsxs)(T.R,{children:[(0,t.jsx)(i.A,{color:"danger",isLoading:N,variant:"light",onPress:L,children:"取消"}),(0,t.jsx)(i.A,{isLoading:N,isDisabled:G,color:"primary",onPress:X,children:"确认"})]})]})})};var A=l(24033);let D=e=>{let{ticker:s,address:l}=e;(0,A.useRouter)();let{address:i}=(0,v.sD)(e=>e),[n,r]=(0,j.useState)(!1),[d,o]=(0,j.useState)(),[u,x]=(0,j.useState)(),[b,p]=(0,j.useState)(1),[y,w]=(0,j.useState)(10),k=(0,j.useMemo)(()=>l?"/ordx/getOrders-".concat(s,"-").concat(l,"-").concat(b,"-").concat(y):"/ordx/getOrders-".concat(s,"-").concat(b,"-").concat(y),[s,l,b,y]),{data:C,isLoading:_,mutate:S}=(0,a.ZP)(k,()=>(0,c.AU)({offset:(b-1)*y,size:y,ticker:s,address:l})),P=async e=>{var s;o(e);let l=await (0,c.xS)({address:i,order_id:e.order_id});if(!(null==l?void 0:null===(s=l.data)||void 0===s?void 0:s.raw)){h.ZP.error({message:"Lock order failed",description:l.msg});return}let{raw:t}=l.data;x(t),r(!0)},M=()=>{S(k)},T=(0,j.useMemo)(()=>{var e,s;return(null==C?void 0:null===(e=C.data)||void 0===e?void 0:e.total)?Math.ceil((null==C?void 0:null===(s=C.data)||void 0===s?void 0:s.total)/y):0},[C,y]),Z=(0,j.useMemo)(()=>{var e;return(null==C?void 0:null===(e=C.data)||void 0===e?void 0:e.order_list)||[]},[C]);return(0,t.jsxs)("div",{className:"",children:[(0,t.jsxs)(g.V,{loading:_,children:[!Z.length&&(0,t.jsx)(m.Z,{className:"mt-10"}),(0,t.jsx)("div",{className:"min-h-[30rem] grid  grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4",children:Z.map(e=>(0,t.jsx)(N,{item:e,onBuy:()=>P(e)},e.utxo))})]}),T>1&&(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(f.t,{total:T,offset:b,size:y,onChange:(e,s)=>{p(e)}})}),!!u&&(0,t.jsx)(z,{item:d,orderRaw:u,onSuccess:()=>M(),onClose:()=>r(!1),visiable:n})]})};var F=l(41298);function R(){let e=(0,A.useRouter)(),s=(0,A.useSearchParams)(),{address:l}=(0,v.sD)(e=>e),m=s.get("ticker"),{data:h}=(0,a.ZP)("getTickerSummary",()=>(0,c.RK)({ticker:m})),f=(0,j.useMemo)(()=>{var e;return(null==h?void 0:null===(e=h.data)||void 0===e?void 0:e.summary)||{}},[h]),g=(0,j.useMemo)(()=>[{value:f.tx_order_count,label:"总交易笔数"},{value:f.tx_total_amount,label:"Volume"},{value:f.tx_total_volume,label:"总成交额"},{value:f.onsell_order_count,label:"在售交易笔数"},{value:f.onsell_total_amount,label:"在售ordx的资产数量"},{value:f.lowest_price,label:"地板价"},{value:f.highest_price,label:"最高价"},{value:f.holder_count,label:"在售持有者数量"}],[f]);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"min-h-40 flex flex-col py-2",children:[(0,t.jsxs)("div",{className:"flex-1 flex items-center mb-4 justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center flex-wrap",children:[(0,t.jsx)(d.J,{src:"/logo.jpg",alt:"logo",className:"mr-2 w-16 h-16"}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("div",{className:"text-2xl md:text-4xl font-bold",children:null==f?void 0:f.ticker})})]}),(0,t.jsx)(y.j,{children:(0,t.jsx)(i.A,{onClick:()=>{e.push("/account")},color:"primary",children:"上架"})})]}),(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:g.map(e=>(0,t.jsx)(n.w,{isHoverable:!0,className:"px-2",children:(0,t.jsxs)(r.G,{className:"text-center",children:[(0,t.jsx)("div",{className:"text-base h-6 md:h-8 md:text-2xl font-bold ",children:e.value}),(0,t.jsx)("div",{className:"text-xs md:text-sm",children:e.label})]})},e.label))})})]}),(0,t.jsx)(o.j,{}),(0,t.jsx)("div",{className:"pt-4",children:(0,t.jsxs)(u.n,{"aria-label":"Options",children:[(0,t.jsx)(x.r,{title:"市场",children:(0,t.jsx)(D,{ticker:m})},"market"),(0,t.jsx)(x.r,{title:"交易历史",children:(0,t.jsx)(F.K,{ticker:m})},"history"),(0,t.jsx)(x.r,{title:"我的挂单",children:(0,t.jsx)(y.j,{className:"mx-auto mt-20 block",children:(0,t.jsx)(D,{ticker:m,address:l})})},"my")]})})]})}},28034:function(e,s,l){"use strict";l.d(s,{V:function(){return i}});var t=l(57437),a=l(45696);l(2265);let i=e=>{let{loading:s=!0,className:l,children:i}=e;return(0,t.jsxs)("div",{className:"relative ".concat(l),children:[i,s&&(0,t.jsx)("div",{className:"absolute top-1/2 left-1/2 z-10 -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)(a.c,{})})]})}},31197:function(e,s,l){"use strict";l.d(s,{t:function(){return i}});var t=l(57437);l(2265);var a=l(88406);let i=e=>{let{total:s,page:l,size:i,onChange:n}=e;return(0,t.jsx)(a.g,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",total:s,initialPage:1,page:l,onChange:n})}},41298:function(e,s,l){"use strict";l.d(s,{K:function(){return w}});var t=l(57437),a=l(42853),i=l(24853),n=l(64903),r=l(53115),c=l(2014),d=l(45696),o=l(51240),u=l(52037),x=l(1525),m=l(95705),h=l(62478),v=l(2265),j=l(56690),f=l(39830),g=l(68638),b=l(31197),p=l(5257),y=l(19174);let N=e=>{let{value:s,onChange:l,disabled:a=!1}=e,[i,n]=(0,v.useState)([(null==s?void 0:s.toString())||"0"]);return(0,t.jsx)(p.g,{isDisabled:a,className:"w-40",selectionMode:"single",selectedKeys:i,defaultSelectedKeys:["0"],onSelectionChange:e=>{n(e);let s=Number(Array.from(e.values())[0]);null==l||l(s)},children:[{label:"不排序",value:0},{label:"价格升序",value:1},{label:"价格降序",value:2},{label:"时间升序",value:3},{label:"时间降序",value:4}].map(e=>(0,t.jsx)(y.R,{value:e.value,children:e.label},e.value))})},w=e=>{let{ticker:s,address:l}=e,{network:p}=(0,g.sD)(e=>e),[y,w]=(0,v.useState)(1),[k,C]=(0,v.useState)(10),[_,S]=(0,v.useState)(0),{data:P,isLoading:M}=(0,a.ZP)("/ordx/history-".concat(s,"-").concat(l,"-").concat(y,"-").concat(k,"-").concat(_),()=>(0,h.s1)({offset:(y-1)*k,size:k,ticker:s,address:l,sort:_}),{revalidateOnMount:!0}),T=(0,v.useMemo)(()=>{var e,s;return(null==P?void 0:null===(e=P.data)||void 0===e?void 0:e.total)?Math.ceil((null==P?void 0:null===(s=P.data)||void 0===s?void 0:s.total)/k):0},[P,k]),Z=(0,v.useMemo)(()=>({1:"成交",2:"下架",3:"无效",10:"卖出",11:"买入"}),[]),E=(0,v.useMemo)(()=>{let e=[{key:"utxo",label:"Utxo",align:"center"},{key:"price",label:"Price",align:"center"},{key:"value",label:"Num",align:"center"},{key:"address",label:"From",align:"center"},{key:"txaddress",label:"To",align:"center",hideHeader:!0},{key:"txtime",label:"Time",align:"center"},{key:"txid",label:"Tx",allowsSorting:!1,align:"center"}],s=e.findIndex(e=>"txaddress"===e.key);return l&&(e.splice(s,1),e.unshift({key:"result",label:"Type",align:"center"})),e},[l]),z=(0,v.useMemo)(()=>{var e;return(null==P?void 0:null===(e=P.data)||void 0===e?void 0:e.order_list)||[]},[P]);return(0,t.jsx)("div",{className:"",children:(0,t.jsxs)(i.b,{isHeaderSticky:!0,isStriped:!0,topContent:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(N,{disabled:!z.length,onChange:e=>{void 0!==e&&S(e)}})}),bottomContent:y>1?(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(b.t,{total:T,offset:y,size:k,onChange:(e,s)=>{w(e)}})}):null,children:[(0,t.jsx)(n.J,{columns:E,children:E.map(e=>(0,t.jsx)(r.j,{align:e.align,children:e.label},e.key))}),(0,t.jsx)(c.y,{isLoading:M,items:z,emptyContent:"No Data.",loadingContent:(0,t.jsx)(d.c,{}),children:e=>(0,t.jsx)(o.g,{children:s=>{if("utxo"===s||"txaddress"===s||"address"===s){let l=(0,u.sF)(e,s);return(0,t.jsx)(x.X,{children:l?(0,t.jsx)(m.Z,{codeString:l,className:"bg-transparent",symbol:"",size:"lg",variant:"flat",children:(0,j.NH)(l,6)}):"-"})}return"txid"===s?(0,t.jsx)(x.X,{children:(0,t.jsx)("a",{href:(0,j.a)((0,u.sF)(e,s),p),target:"_blank",children:(0,t.jsx)(f.JO,{icon:"ph:share-fill"})})}):"txtime"===s?(0,t.jsx)(x.X,{children:(0,t.jsx)("span",{children:new Date(Number((0,u.sF)(e,s))).toLocaleString()})}):"result"===s?(0,t.jsx)(x.X,{children:Z[(0,u.sF)(e,s)]}):(0,t.jsx)(x.X,{children:"".concat((0,u.sF)(e,s)).concat("price"===s?" "+e.currency:"")})}},e.order_id)})]})})}},89324:function(e,s,l){"use strict";l.d(s,{j:function(){return c}});var t=l(57437),a=l(19505),i=l(68638),n=l(2265),r=l(41774);let c=e=>{let{children:s,className:l}=e,[c,d]=n.useState(!1),{connected:o}=(0,i.sD)(e=>e);return o?(0,t.jsx)(t.Fragment,{children:s}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.A,{onClick:()=>d(!0),size:"sm",radius:"full",className:l,color:"primary",children:"Connect Wallet"}),(0,t.jsx)(r.u,{visiable:c,onClose:()=>d(!1)})]})}},41774:function(e,s,l){"use strict";l.d(s,{u:function(){return j}});var t=l(57437),a=l(2265),i=l(48615),n=l(95844),r=l(72021),c=l(61718),d=l(69571),o=l(42891),u=l(21507),x=l(45696),m=l(14511),h=l(48749),v=l(68638);let j=e=>{let{visiable:s,onClose:l}=e,{connect:j,installed:f}=(0,v.sD)(e=>e),[g,b]=(0,a.useState)(!1),{isOpen:p,onOpen:y,onOpenChange:N,onClose:w}=(0,i.q)(),k=async()=>{b(!0);try{await j(),null==l||l()}catch(e){h.ZP.error({message:"Connect Wallet Failed",description:e.message})}finally{b(!1)}};return(0,a.useEffect)(()=>{s?y():w()},[s]),(0,t.jsx)(n.R,{backdrop:"blur",isDismissable:!1,isOpen:p,onOpenChange:N,onClose:l,children:(0,t.jsxs)(r.A,{children:[(0,t.jsx)(c.k,{className:"",children:"Select a wallet to connect"}),(0,t.jsx)(d.I,{className:"pb-4",children:(0,t.jsx)(o.w,{isPressable:!0,isDisabled:g,onClick:k,children:(0,t.jsx)(u.G,{children:g?(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(x.c,{})}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(m.J,{src:"/logo/unisat.svg",alt:"unisat logo",className:"w-10 h-10 mr-2"}),(0,t.jsx)("span",{className:"text-lg md:text-2xl font-bold flex-1",children:"Unisat Wallet"}),!f&&(0,t.jsx)("span",{className:"justify-self-end text-orange-400",children:"Not Installed"})]})})})})]})})}}},function(e){e.O(0,[121,645,890,208,785,391,853,513,637,705,521,652,586,971,472,744],function(){return e(e.s=3833)}),_N_E=e.O()}]);