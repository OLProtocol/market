"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[586],{62478:function(t,e,n){n.d(e,{Hj:function(){return h},sl:function(){return p},jn:function(){return x},Sf:function(){return y},s1:function(){return l},AU:function(){return u},Ro:function(){return i},RK:function(){return s},eb:function(){return c},Oy:function(){return m},wt:function(){return g},xS:function(){return f},pm:function(){return d},n3:function(){return w}});var a=n(56690),r=n(68638);let o=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{signature:n,publicKey:o,unisat:i,connected:s}=r.sD.getState(),{headers:u={},method:l="GET",data:c}=e,d="https://apitest.ordx.market".concat(t);if("GET"===l){let t=new URLSearchParams((0,a.$B)(c));d+="?".concat(t)}else"POST"===l&&(e.body=JSON.stringify(c),u["Content-Type"]="application/json");s&&n&&(u.Publickey=o,u.Signature=n),delete e.data,e.headers=u;let p=await fetch(d,e);return p},i=async t=>{let{address:e,offset:n,size:a,type:r,ticker:i}=t,s=await o("/ordx/GetAddressOrdxAssets",{data:{address:e,offset:n,size:a,type:r,ticker:i}});return s.json()},s=async t=>{let{ticker:e}=t,n=await o("/ordx/GetTickerSummary",{data:{ticker:e}});return n.json()},u=async t=>{let{ticker:e,offset:n,size:a,sort:r=0,type:i=1,address:s}=t,u=await o("/ordx/GetOrders",{data:{ticker:e,offset:n,size:a,sort:r,type:i,address:s}});return u.json()},l=async t=>{let{ticker:e,offset:n,size:a,sort:r=0,address:i}=t,s=await o("/ordx/GetHistory",{data:{ticker:e,offset:n,size:a,sort:r,address:i}});return s.json()},c=async t=>{let{interval:e=1,top_count:n=10,top_list:a="tx_amount"}=t,r=await o("/ordx/GetTopTickers",{data:{interval:e,top_count:n,top_list:a}});return r.json()},d=async t=>{let{address:e,raw:n}=t,a=await o("/ordx/SubmitOrder",{method:"POST",data:{address:e,raw:n}});return a.json()},p=async t=>{let{address:e,order_id:n}=t,a=await o("/ordx/CancelOrder",{method:"POST",data:{address:e,order_id:n}});return a.json()},f=async t=>{let{address:e,order_id:n}=t,a=await o("/ordx/LockOrder",{method:"POST",data:{address:e,order_id:n}});return a.json()},w=async t=>{let{address:e,order_id:n}=t,a=await o("/ordx/UnlockOrder",{method:"POST",data:{address:e,order_id:n}});return a.json()},h=async t=>{let{address:e,order_id:n,raw:a}=t,r=await o("/ordx/BuyOrder",{method:"POST",data:{address:e,order_id:n,raw:a}});return r.json()},g=async t=>{let{address:e,value:n=600,network:a}=t,r=await fetch("https://apitest.ordx.space/testnet/utxo/getUtxoByValue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:e,value:n})});return r.json()},x=async t=>{let e=await fetch("testnet"===t?"https://mempool.space/testnet/api/v1/fees/recommended":"https://mempool.space/api/v1/fees/recommended"),n=await e.json();return n},y=async()=>{let t=await fetch("/version.txt");return console.log("appVersion",await t.text()),t.text()},m=async(t,e)=>{let n="https://mempool.space".concat("testnet"===e?"/testnet":"","/api/tx/").concat(t,"/hex"),a=await fetch(n).then(t=>t.text()).then(t=>{if("Transaction not found"===t)throw Error("Some error happened when finding BTC to pay. Please try again later.");return t});return a}},56690:function(t,e,n){n.d(e,{g:function(){return v},Us:function(){return d},eB:function(){return c},zU:function(){return S},NH:function(){return E},u4:function(){return y},$B:function(){return O},a:function(){return k},Ay:function(){return m}});var a=n(99301),r=n(81254),o=n(24128),i=n(33261),s=n(62478),u=n(40263).Buffer;let l=t=>{var e;let n=null===(e=o.Xf.fmt.toAsm(o.kL.toScriptPubKey(t)))||void 0===e?void 0:e[0];return n},c=async t=>{let{inscriptionUtxo:e,total:n,amount:o,network:i,address:u}=t,l=await (0,s.Oy)(e.txid,i),c=a.YW.fromHex(l);console.log(c);let d={hash:e.txid,index:e.vout,witnessUtxo:c.outs[e.vout],sighashType:131};console.log(d);let p=new a._B({network:"testnet"===i?a.QW.testnet:a.QW.bitcoin});a.Wi(r),console.log(u,n),p.addInput(d),p.addOutput({address:u,value:n});let f=await window.unisat.signPsbt(p.toHex());return f},d=async t=>{let{orderId:e,orderRaw:n,network:o,address:s,fee:c,utxos:d,serviceFee:p,dummyUtxos:f}=t;(0,i.env)("NEXT_PUBLIC_SERVICE_FEE");let w=(0,i.env)("NEXT_PUBLIC_IS_FREE"),h=(0,i.env)("NEXT_PUBLIC_SERVICE_ADDRESS");a.Wi(r);let g="testnet"===o?a.QW.testnet:a.QW.bitcoin,x=a._B.fromHex(n,{network:g}),y=new a._B({network:g});console.log(x);let m=d.reduce((t,e)=>t+e.value,0),v=d.map(t=>({hash:t.txid,index:t.vout,witnessUtxo:{script:u.from(l(s),"hex"),value:t.value}})),S=f.reduce((t,e)=>t+e.value,0),E=f.map(t=>({hash:t.txid,index:t.vout,witnessUtxo:{script:u.from(l(s),"hex"),value:t.value},sighashType:a.YW.SIGHASH_ALL}));E.forEach(t=>{y.addInput(t)}),y.addOutput({address:s,value:S}),console.log(v);let O={hash:x.txInputs[0].hash,index:x.txInputs[0].index,witnessUtxo:x.data.inputs[0].witnessUtxo,finalScriptWitness:x.data.inputs[0].finalScriptWitness};y.addInput(O),v.forEach(t=>{y.addInput(t)});let k=x.data.inputs[0].witnessUtxo.value;y.addOutput({address:s,value:k});let b=x.txOutputs[0].value,U=x.txOutputs[0];y.addOutput(U);let T=m-(b+c)-1200;"0"===w&&p&&h&&(T-=p,y.addOutput({address:h,value:p})),y.addOutput({address:s,value:600}),y.addOutput({address:s,value:600});let j={address:s,value:T};y.addOutput(j);let P=await window.unisat.signPsbt(y.toHex()),_=a._B.fromHex(P,{network:g}),B=_.extractTransaction(),I=B.toHex();return I};var p=n(51864),f=n.n(p),w=n(90555),h=n.n(w),g=n(34098),x=n.n(g);let y=t=>{let[e,n]=t.split(":");return{txid:e,vout:parseInt(n)}},m=t=>{t>=1e8&&(t*=10);let e=String(t).padStart(8,"0").slice(0,-9)+"."+String(t).padStart(8,"0").slice(-9);return"."==e.substring(0,1)&&(e="0"+e),e},v=t=>{let[e,n]=t.toString().split(".");return n||(n="0"),1e8*parseInt(e)+parseInt(n.padEnd(8,"0"))},S=function(t,e){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=f()(t,"value"),r=x()(a);n&&h()(r);let o=[],i=0;for(let t=0;t<r.length;t++){let n=r[t];if(o.push(n),(i+=n.value)>=e)break}return{minUtxo:a[0],maxUtxo:a[a.length-1],utxos:o,smallTwoUtxos:a.slice(0,2),total:i}},E=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*****";return"string"==typeof t&&t?"".concat(null==t?void 0:t.substring(0,e)).concat(n).concat(null==t?void 0:t.substring((null==t?void 0:t.length)-e)):""},O=t=>{let e={...t};return Object.keys(e).forEach(t=>{(""===e[t]||void 0===e[t]||null===e[t]||"null"===e[t]||"undefined"===e[t]||"NaN"===e[t]||isNaN(e[t])&&"number"==typeof e[t])&&delete e[t]}),e},k=(t,e)=>"testnet"===e?"https://mempool.space/testnet/tx/".concat(t):"https://mempool.space/tx/".concat(t)},68638:function(t,e,n){n.d(e,{Ee:function(){return u},JU:function(){return o},sD:function(){return s}});var a=n(94660),r=n(74810);let o=(0,a.Ue)()((0,r.mW)(t=>({list:[],add:e=>{t(t=>({list:[...t.list,e]}))},reset:()=>{t({list:[]})}}))),i={balance:{confirmed:0,unconfirmed:0,total:0},publicKey:"",address:"",unisat:null,connected:!1,installed:!1,network:"testnet"},s=(0,a.Ue)()((0,r.mW)((0,r.tJ)((t,e)=>({...i,sign:async e=>{try{let n=window.unisat;if(!n)throw Error("Unisat not installed");let a=await n.signMessage(e);t(t=>({signature:a}))}catch(t){throw console.error("Error signing message",t),t}},check:async()=>{try{let n=window.unisat;if(!n)throw t(t=>({installed:!1})),Error("Unisat not installed");if(t(t=>({installed:!0,unisat:n})),!e().signature)return;let a=await n.getAccounts();if(a.length){let e=a[0],r=await n.getNetwork(),o=await n.getPublicKey(),i=await n.getBalance();t(t=>({publicKey:o,address:e,balance:i,connected:!0,network:r}))}}catch(t){throw console.error("Error checking unisat",t),t}},connect:async()=>{try{let n=window.unisat;if(!n)throw Error("Unisat not installed");let a=await n.requestAccounts();if(a.length){let r=e().signature;r||(r=await n.signMessage("tinyverse-ordx-marketplace"));let o=a[0],i=await n.getPublicKey(),s=await n.getNetwork(),u=await n.getBalance();t(t=>({publicKey:i,address:o,balance:u,connected:!0,network:s,unisat:n,signature:r}))}}catch(t){throw console.error("Error checking unisat",t),t}},disconnect:()=>t(t=>({connected:!1,publicKey:"",address:"",balance:{confirmed:0,unconfirmed:0,total:0},signature:void 0,unisat:null,installed:!0})),switchNetwork:async()=>{try{let n=window.unisat;if(!n)throw Error("Unisat not installed");let a="testnet"===e().network?"livenet":"testnet";await n.switchNetwork(a),t(t=>({network:a}));let r=await n.getAccounts();if(r.length){let e=r[0],a=await n.getPublicKey(),o=await n.getBalance();t(t=>({publicKey:a,address:e,balance:o,connected:!0,unisat:n}))}}catch(t){throw console.error("Error checking unisat",t),t}}}),{name:"unisat-store",partialize:t=>Object.fromEntries(Object.entries(t).filter(t=>{let[e]=t;return["signature"].includes(e)}))}))),u=(0,a.Ue)()((0,r.mW)(t=>({feeRate:{value:1,type:"custom"},appVersion:0,setFeeRate:e=>{t({feeRate:e})},reset:()=>{t({feeRate:{value:1,type:"custom"},appVersion:0})}})))}}]);